<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Présentation</title>

  <style>
    html, body {
      height:100%;
      margin:0;
      background:#000;
      overflow:hidden;
    }
    body { outline:none; }

    .slide {
      display:none;
      width:100vw;
      height:100vh;
      align-items:center;
      justify-content:center;
      position:relative;
    }
    .slide.active { display:flex; }

    img, video {
      max-width:100vw;
      max-height:100vh;
      object-fit:contain;
      background:#000;
    }

    iframe {
      width:100vw;
      height:100vh;
      border:0;
      background:#000;
    }

    /* Écran de démarrage */
    #startOverlay{
      position:fixed;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      background:#000;
      z-index:9999;
      cursor:pointer;
      user-select:none;
    }
    #startOverlay .box{
      font-family: Arial, sans-serif;
      color:#fff;
      text-align:center;
      padding:24px 28px;
      border:2px solid rgba(255,255,255,.25);
      border-radius:16px;
      max-width:760px;
    }
    #startOverlay .big{
      font-size:34px;
      font-weight:700;
      margin-bottom:10px;
    }
    #startOverlay .small{
      font-size:18px;
      opacity:.85;
    }
  </style>
</head>

<body tabindex="0">

<!-- Écran de démarrage -->
<div id="startOverlay">
  <div class="box">
    <div class="big">Cliquez ou appuyez sur une touche pour démarrer</div>
    <div class="small">Plein écran + lancement</div>
  </div>
</div>

<!-- 1 -->
<section class="slide"><img src="media/img_01_intro.png"></section>

<!-- 2 -->
<section class="slide">
  <video playsinline preload="auto" muted>
    <source src="media/vid_01_debut_web.mp4" type="video/mp4">
  </video>
</section>

<!-- 3 -->
<section class="slide"><img src="media/img_02_preparation_vote_1.png"></section>
<!-- 4 -->
<section class="slide"><iframe data-vote="1"></iframe></section>

<!-- 5 -->
<section class="slide"><img src="media/img_03_preparation_vote_2.png"></section>
<!-- 6 -->
<section class="slide"><iframe data-vote="2"></iframe></section>

<!-- 7 -->
<section class="slide"><img src="media/img_04_preparation_vote_3.png"></section>
<!-- 8 -->
<section class="slide"><iframe data-vote="3"></iframe></section>

<!-- 9 -->
<section class="slide"><img src="media/img_05_preparation_vote_4.png"></section>
<!-- 10 -->
<section class="slide"><iframe data-vote="4"></iframe></section>

<!-- 11 -->
<section class="slide">
  <video src="media/vid_02_centrale.mp4" playsinline preload="auto" muted></video>
</section>

<!-- 12 : NOUVELLE IMAGE -->
<section class="slide">
  <img src="media/img_061_nicolas_00.png">
</section>

<!-- 13 -->
<section class="slide"><img src="media/img_06_nicolas_01.jpeg"></section>

<!-- 14 -->
<section class="slide"><img src="media/img_07_nicolas_02.png"></section>

<!-- 15 -->
<section class="slide">
  <video playsinline preload="auto" muted>
    <source src="media/vid_03_conclusion_H264.mp4" type="video/mp4">
  </video>
</section>

<!-- 16 -->
<section class="slide"><img src="media/img_08_preparation_vote_5.png"></section>
<!-- 17 -->
<section class="slide"><iframe data-vote="5"></iframe></section>

<!-- 18 -->
<section class="slide"><img src="media/img_09_preparation_vote_6.png"></section>
<!-- 19 -->
<section class="slide"><iframe data-vote="6"></iframe></section>

<!-- 20 -->
<section class="slide"><img src="media/img_10_preparation_vote_7.png"></section>
<!-- 21 -->
<section class="slide"><iframe data-vote="7"></iframe></section>

<!-- 22 -->
<section class="slide"><img src="media/img_11_preparation_vote_8.png"></section>
<!-- 23 -->
<section class="slide"><iframe data-vote="8"></iframe></section>

<!-- 24 -->
<section class="slide"><img src="media/img_12_finale.png"></section>

<script>
const slides = Array.from(document.querySelectorAll(".slide"));
let i = 0;
let started = false;
let lastNav = 0;

const overlay = document.getElementById("startOverlay");

function hardFocus(){
  try{ window.focus(); }catch(e){}
  try{ document.body.focus({preventScroll:true}); }catch(e){}
}

function stopAllVideos(){
  document.querySelectorAll("video").forEach(v=>{
    try{ v.pause(); v.currentTime=0; v.onended=null; }catch(e){}
  });
}

function unloadIframe(slide){
  const f = slide.querySelector("iframe");
  if(f) f.src="about:blank";
}

function loadVote(slide){
  const f = slide.querySelector("iframe");
  if(!f) return;
  const n = f.dataset.vote;
  f.src = `https://frodo1515.github.io/demosvotes/vote.html?vote=${n}&_ts=${Date.now()}`;
}

async function playVideo(v){
  try{
    await v.play();
    if(started) v.muted=false;
  }catch(e){}
}

async function enterSlide(){
  const s = slides[i];
  hardFocus();

  const iframe = s.querySelector("iframe");
  if(iframe){ loadVote(s); return; }

  const video = s.querySelector("video");
  if(video){
    video.onended = next;
    await playVideo(video);
  }
}

async function activate(n){
  if(n<0 || n>=slides.length) return;
  unloadIframe(slides[i]);
  stopAllVideos();
  slides[i].classList.remove("active");
  i=n;
  slides[i].classList.add("active");
  await enterSlide();
}

function next(){ activate(i+1); }
function prev(){ activate(i-1); }

async function startOnce(){
  if(started) return;
  started=true;
  overlay.remove();
  try{
    if(!document.fullscreenElement){
      await document.documentElement.requestFullscreen();
    }
  }catch(e){}
  slides[0].classList.add("active");
}

window.addEventListener("keydown", async e=>{
  if(!started){
    e.preventDefault();
    await startOnce();
    return;
  }
  const now = Date.now();
  if(now-lastNav<250) return;

  if(["ArrowRight"," ","Enter","PageDown"].includes(e.key)){
    lastNav=now; next();
  }
  if(["ArrowLeft","PageUp"].includes(e.key)){
    lastNav=now; prev();
  }
});

window.addEventListener("click", async ()=>{
  if(!started) await startOnce();
},{capture:true});

slides[0].classList.add("active");
</script>

</body>
</html>
