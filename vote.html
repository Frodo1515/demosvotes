<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Vote en cours</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="cache-control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="expires" content="0">
  <style>
    :root{
      --bg:#0f0f10; --card:#17171a; --text:#fff; --muted:rgba(255,255,255,.75);
      --accent:#4caf50; --stroke:rgba(255,255,255,.12);
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--text);
      min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px;}
    .wrap{width:min(1100px,100%);display:grid;gap:18px;}
    .top{display:flex;align-items:flex-end;justify-content:space-between;gap:16px;flex-wrap:wrap;}
    .title{display:flex;flex-direction:column;gap:6px}
    h1{margin:0;font-size:clamp(28px,3vw,46px);letter-spacing:.5px}
    .subtitle{margin:0;color:var(--muted);font-size:clamp(14px,1.6vw,18px)}
    .card{background:var(--card);border:1px solid var(--stroke);border-radius:22px;padding:18px}
    .timer{min-width:280px}
    .timer .label{color:var(--muted);font-size:14px}
    .timer .seconds{font-variant-numeric:tabular-nums;font-size:42px;font-weight:800;letter-spacing:1px}
    .bar{width:100%;height:10px;border-radius:999px;background:rgba(255,255,255,.10);overflow:hidden;margin-top:8px}
    .bar>div{height:100%;width:100%;background:var(--accent);transform-origin:left;transform:scaleX(1);transition:transform .25s linear}
    .main{display:grid;grid-template-columns:1.1fr .9fr;gap:18px}
    @media(max-width:860px){.main{grid-template-columns:1fr}.timer{min-width:unset;width:100%}}
    .qrbox{display:flex;align-items:center;justify-content:center;min-height:520px}
    .qrimg{width:min(520px,100%);aspect-ratio:1/1;border-radius:18px;background:#fff;padding:16px;display:flex;align-items:center;justify-content:center}
    .qrimg img{width:100%;height:100%;object-fit:contain}
    .right{display:flex;flex-direction:column;gap:14px}
    .pillrow{display:flex;gap:10px;flex-wrap:wrap;margin-top:6px}
    .pill{border:1px solid var(--stroke);background:rgba(255,255,255,.06);padding:8px 10px;border-radius:999px;font-size:13px;color:var(--muted)}
    .actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:auto}
    button{border:0;border-radius:14px;padding:12px 14px;font-size:15px;cursor:pointer;font-weight:650}
    .btn-primary{background:var(--accent);color:#081108}
    .btn-ghost{background:rgba(255,255,255,.08);color:var(--text);border:1px solid var(--stroke)}
  </style>
</head>

<body>
  <div class="wrap">
    <div class="top">
      <div class="title">
        <h1 id="h1">VOTE</h1>
        <p class="subtitle" id="subtitle">Scannez le QR code et votez maintenant.</p>
      </div>

      <div class="timer card">
        <div style="display:flex; align-items:baseline; justify-content:space-between; gap:12px;">
          <div class="label">Temps restant</div>
          <div class="seconds"><span id="sec">45</span>s</div>
        </div>
        <div class="bar"><div id="barfill"></div></div>
      </div>
    </div>

    <div class="main">
      <div class="card qrbox">
        <div class="qrimg">
          <img id="qr" alt="QR Code">
        </div>
      </div>

      <div class="card right">
        <div class="pillrow">
          <div class="pill" id="pillVote">Vote: —</div>
          <div class="pill">Durée: 45 sec</div>
          <div class="pill">Résultats: en direct</div>
        </div>

        <div class="actions">
          <button class="btn-primary" id="btnResults">Afficher les résultats</button>
          <button class="btn-ghost" id="btnRestart">Relancer 45s</button>
        </div>

        <div style="color:rgba(255,255,255,.75);font-size:14px;line-height:1.5">
          Astuce : tu peux aussi afficher ces QR codes sur papier.<br>
          URL : <code>vote.html?vote=Vote1</code> … <code>Vote8</code>
        </div>
      </div>
    </div>
  </div>

<script>
(function(){
  const DURATION = 45;

  const u = new URL(window.location.href);
  const vote = u.searchParams.get("vote") || "Vote1"; // Vote1..Vote8
  const n = (vote.match(/\d+/) || ["1"])[0];          // "1".."8"

  // Affichage du bon PNG (dossier /qrs/)
  const qrImg = document.getElementById("qr");
  qrImg.src = `qrs/VOTE_${n}.png?nocache=${Date.now()}`;

  // Résultats (poll=vote1..vote8)
  const poll = `vote${n}`;
  const resultsLink = `resultat.html?poll=${encodeURIComponent(poll)}&nocache=${Date.now()}`;

  // UI
  document.getElementById("h1").textContent = vote.replace("Vote","VOTE ");
  document.getElementById("pillVote").textContent = "Vote: " + vote.replace("Vote","VOTE ");

  document.getElementById("btnResults").onclick = () => location.href = resultsLink;

  // Countdown
  let remaining = DURATION;
  let timer = null;
  const secEl = document.getElementById("sec");
  const barfill = document.getElementById("barfill");
  const subtitle = document.getElementById("subtitle");

  function render(){
    secEl.textContent = String(remaining);
    barfill.style.transform = `scaleX(${Math.max(0, remaining / DURATION)})`;
  }

  function endVote(){
    clearInterval(timer); timer=null;
    remaining = 0; render();
    subtitle.textContent = "Vote terminé. Affichage des résultats…";
    setTimeout(() => location.href = resultsLink, 800);
  }

  function start(){
    clearInterval(timer);
    remaining = DURATION;
    subtitle.textContent = "Scannez le QR code et votez maintenant.";
    render();
    timer = setInterval(() => {
      remaining--;
      render();
      if (remaining <= 0) endVote();
    }, 1000);
  }

  document.getElementById("btnRestart").onclick = start;

  start();
})();
</script>
</body>
</html>
