<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Vote – DÉMOS</title>

<style>
body{
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  background:#0b1020;
  color:#fff;
  margin:0;
  padding:20px;
}
h1{ font-size:22px; margin-bottom:16px; }
.option{
  padding:14px;
  margin-bottom:12px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.2);
  background:rgba(255,255,255,.05);
  cursor:pointer;
}
.option:hover{ background:rgba(79,209,197,.2); }
.ok{
  margin-top:20px;
  padding:14px;
  border-radius:12px;
  background:rgba(79,209,197,.15);
}
.err{
  margin-top:20px;
  padding:14px;
  border-radius:12px;
  background:rgba(255,107,107,.2);
}
</style>
</head>

<body>

<h1 id="title">Chargement…</h1>
<div id="options"></div>

<div class="ok" id="okBox" style="display:none;"></div>
<div class="err" id="errBox" style="display:none;"></div>

<script src="./polls.js"></script>
<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwfHhgAvrqguR88WYrYNmbMcVeHikMl_c2RFJr-jLfhOhFGsW3nsISAuo7kGKCSYXtp/exec";

const url = new URL(location.href);
const vote = parseInt(url.searchParams.get("vote") || "1", 10);

const polls = window.POLLS || {};
const poll = polls[vote];

const title = document.getElementById("title");
const optionsDiv = document.getElementById("options");
const okBox = document.getElementById("okBox");
const errBox = document.getElementById("errBox");

if(!poll){
  title.textContent = "Question introuvable";
}else{
  title.textContent = poll.title;
  poll.options.forEach((txt, i) => {
    const letter = String.fromCharCode(65 + i);
    const div = document.createElement("div");
    div.className = "option";
    div.textContent = txt;
    div.onclick = () => send(letter);
    optionsDiv.appendChild(div);
  });
}

function send(letter){
  fetch(SCRIPT_URL, {
    method:"POST",
    body: JSON.stringify({ vote, choice: letter })
  })
  .then(r => r.json())
  .then(data => {
    if(data.status === "ok"){
      okBox.style.display = "block";
      okBox.textContent = "Merci ! Votre vote a été pris en compte.";
    }else{
      throw new Error(data.message || "Erreur");
    }
  })
  .catch(e => {
    errBox.style.display = "block";
    errBox.textContent = "Erreur lors de l’enregistrement du vote.";
  });
}
</script>

</body>
</html>
